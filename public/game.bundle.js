(()=>{var T=function(e,t){return T=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)r.hasOwnProperty(i)&&(n[i]=r[i])},T(e,t)};function V(e,t){T(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function C(e){var t=typeof Symbol=="function"&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function L(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,s=[],f;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(l){f={error:l}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(f)throw f.error}}return s}function j(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(L(arguments[t]));return e}var x=function(){function e(t,n){this.target=n,this.type=t}return e}(),k=function(e){V(t,e);function t(n,r){var i=e.call(this,"error",r)||this;return i.message=n.message,i.error=n,i}return t}(x),N=function(e){V(t,e);function t(n,r,i){n===void 0&&(n=1e3),r===void 0&&(r="");var s=e.call(this,"close",i)||this;return s.wasClean=!0,s.code=n,s.reason=r,s}return t}(x);var M=function(){if(typeof WebSocket<"u")return WebSocket},D=function(e){return typeof e<"u"&&!!e&&e.CLOSING===2},E={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},W=function(){function e(t,n,r){var i=this;r===void 0&&(r={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(s){i._debug("open event");var f=i._options.minUptime,l=f===void 0?E.minUptime:f;clearTimeout(i._connectTimeout),i._uptimeTimeout=setTimeout(function(){return i._acceptOpen()},l),i._ws.binaryType=i._binaryType,i._messageQueue.forEach(function(p){return i._ws.send(p)}),i._messageQueue=[],i.onopen&&i.onopen(s),i._listeners.open.forEach(function(p){return i._callEventListener(s,p)})},this._handleMessage=function(s){i._debug("message event"),i.onmessage&&i.onmessage(s),i._listeners.message.forEach(function(f){return i._callEventListener(s,f)})},this._handleError=function(s){i._debug("error event",s.message),i._disconnect(void 0,s.message==="TIMEOUT"?"timeout":void 0),i.onerror&&i.onerror(s),i._debug("exec error listeners"),i._listeners.error.forEach(function(f){return i._callEventListener(s,f)}),i._connect()},this._handleClose=function(s){i._debug("close event"),i._clearTimeouts(),i._shouldReconnect&&i._connect(),i.onclose&&i.onclose(s),i._listeners.close.forEach(function(f){return i._callEventListener(s,f)})},this._url=t,this._protocols=n,this._options=r,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(e,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CONNECTING",{get:function(){return e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"OPEN",{get:function(){return e.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSING",{get:function(){return e.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"CLOSED",{get:function(){return e.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(t){this._binaryType=t,this._ws&&(this._ws.binaryType=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bufferedAmount",{get:function(){var t=this._messageQueue.reduce(function(n,r){return typeof r=="string"?n+=r.length:r instanceof Blob?n+=r.size:n+=r.byteLength,n},0);return t+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),e.prototype.close=function(t,n){if(t===void 0&&(t=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(t,n)},e.prototype.reconnect=function(t,n){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(t,n),this._connect())},e.prototype.send=function(t){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",t),this._ws.send(t);else{var n=this._options.maxEnqueuedMessages,r=n===void 0?E.maxEnqueuedMessages:n;this._messageQueue.length<r&&(this._debug("enqueue",t),this._messageQueue.push(t))}},e.prototype.addEventListener=function(t,n){this._listeners[t]&&this._listeners[t].push(n)},e.prototype.dispatchEvent=function(t){var n,r,i=this._listeners[t.type];if(i)try{for(var s=C(i),f=s.next();!f.done;f=s.next()){var l=f.value;this._callEventListener(t,l)}}catch(p){n={error:p}}finally{try{f&&!f.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return!0},e.prototype.removeEventListener=function(t,n){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter(function(r){return r!==n}))},e.prototype._debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._options.debug&&console.log.apply(console,j(["RWS>"],t))},e.prototype._getNextDelay=function(){var t=this._options,n=t.reconnectionDelayGrowFactor,r=n===void 0?E.reconnectionDelayGrowFactor:n,i=t.minReconnectionDelay,s=i===void 0?E.minReconnectionDelay:i,f=t.maxReconnectionDelay,l=f===void 0?E.maxReconnectionDelay:f,p=0;return this._retryCount>0&&(p=s*Math.pow(r,this._retryCount-1),p>l&&(p=l)),this._debug("next delay",p),p},e.prototype._wait=function(){var t=this;return new Promise(function(n){setTimeout(n,t._getNextDelay())})},e.prototype._getNextUrl=function(t){if(typeof t=="string")return Promise.resolve(t);if(typeof t=="function"){var n=t();if(typeof n=="string")return Promise.resolve(n);if(n.then)return n}throw Error("Invalid URL")},e.prototype._connect=function(){var t=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var n=this._options,r=n.maxRetries,i=r===void 0?E.maxRetries:r,s=n.connectionTimeout,f=s===void 0?E.connectionTimeout:s,l=n.WebSocket,p=l===void 0?M():l;if(this._retryCount>=i){this._debug("max retries reached",this._retryCount,">=",i);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!D(p))throw Error("No valid WebSocket class provided");this._wait().then(function(){return t._getNextUrl(t._url)}).then(function(I){t._closeCalled||(t._debug("connect",{url:I,protocols:t._protocols}),t._ws=t._protocols?new p(I,t._protocols):new p(I),t._ws.binaryType=t._binaryType,t._connectLock=!1,t._addListeners(),t._connectTimeout=setTimeout(function(){return t._handleTimeout()},f))})}},e.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new k(Error("TIMEOUT"),this))},e.prototype._disconnect=function(t,n){if(t===void 0&&(t=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(t,n),this._handleClose(new N(t,n,this))}catch{}}},e.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},e.prototype._callEventListener=function(t,n){"handleEvent"in n?n.handleEvent(t):n(t)},e.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},e.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},e.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},e}(),A=W;window.init=async function(t){let n=new A(`${location.protocol.replace("http","ws")}//${location.host}${t}`),r=async l=>new Promise((p,I)=>{let h=Date.now();l.send("ping"),l.onmessage=_=>{_.data==="pong"&&p(Date.now()-h)}}),i={w:!1,up:!1};window.addEventListener("basket-key",l=>{l.detail.type==="keydown"?l.detail.key==="w"?i.w=!0:l.detail.key==="ArrowUp"&&(i.up=!0):l.detail.type==="keyup"&&(l.detail.key==="w"?i.w=!1:l.detail.key==="ArrowUp"&&(i.up=!1)),n.send(JSON.stringify({type:"key",event:l.detail.type,key:l.detail.key}))}),window.ready=function(){n.readyState===WebSocket.OPEN&&n.send(JSON.stringify({type:"ready"}))},window.unpause=function(){document.querySelector("iframe").contentWindow.c3_runtimeInterface._localRuntime.SetSuspended(!1),document.querySelector("iframe").focus()};let s=0,f=null;n.addEventListener("open",()=>{console.log("WebSocket connection established"),f&&clearInterval(f),f=setInterval(()=>{r(n).then(l=>{window.postMessage({type:"ping",data:l},"*")})},1e3),s=0}),n.addEventListener("message",l=>{try{let p=JSON.parse(l.data);p.type==="update"&&window.postMessage({type:"update",data:p.message},"*")}catch{}if(l.data==="loaded"&&window.postMessage({type:"loaded"},"*"),l.data==="start"){let I=function(h){let _=[",","*","&","^","~","=","@","//","??","..","AA","QT","``","__"],y=h.match(/([A-Z]{2})=([a-zA-Z0-9_]+)/g),o=h.replace(/^[^()]+\(\)/,""),m=Object.fromEntries(y.map(u=>u.split("=").map(v=>v.trim())));for(var c in m)o=o.replaceAll(c,m[c]);function a(u,v=0){let b={},R=_[v],O=u.split(R);for(let g of O)if(g.match(/^([^\|\{\}\[]+)\|(.+)\|/)){let[S,w]=g.match(/^([^\|\{\}\[]+)\|(.+)\|/).slice(1,3);w.match(/^[\-\d\.]+$/)&&(w=parseFloat(w)),b[S]=w}else if(g.match(/^([^\|\{\}\[]+)\[(.+)\]/)){let[S,w]=g.match(/^([^\|\{\}\[]+)\[(.+)\]/).slice(1,3);b[S]=d(w,v+1)}else if(g.match(/^([^\|\{\}\[]+)\{(.+)\}/)){let[S,w]=g.match(/^([^\|\{\}\[]+)\{(.+)\}/).slice(1,3);b[S]=a(w,v+1)}return b}function d(u,v=0){let b=[],R=_[v],O=u.split(R);for(let g of O){if(g.match(/^[\-\d\.]+$/)){b.push(parseFloat(g));continue}b.push(a(g,v+1))}return b}return a(o)};document.querySelector("iframe").contentWindow.started=!0,window.postMessage({type:"start"},"*"),setInterval(()=>{},1e3);let p=()=>{let h=document.querySelector("iframe").contentWindow,_=h.savedGlobalVars||{p1Score:0,p2Score:0,goal:0};try{h.c3_runtimeInterface._localRuntime._layoutManager._layoutsByName.get("game")._layersByName.get("ui")._instances[2]._sdkInst._SetText(String(_.p2Score)),h.c3_runtimeInterface._localRuntime._layoutManager._layoutsByName.get("game")._layersByName.get("ui")._instances[3]._sdkInst._SetText(String(_.p1Score))}catch{}for(let o of h.heads);for(let o of h.players)o.x=o.savedX,o.y=o.savedY,o.angle=o.savedAngle,Array.isArray(o.savedVelocity)&&(o.savedX+=o.savedVelocity[0]/60,o.savedY+=o.savedVelocity[1]/60,o.savedVelocity[1]>100&&(o.savedVelocity[1]=100),(o.y<140||o.savedVelocity[1]<0)&&(o.savedVelocity[1]+=4),o.savedVelocity[1]>0&&o.y>140&&(o.savedVelocity[1]=0)),o.savedAngularVelocity&&(o.savedAngle+=o.savedAngularVelocity/60);for(let o of h.arms)switch(o.x=o.savedX,o.y=o.savedY,o.angle=o.savedAngle,h.arms.indexOf(o)){case 0:case 1:{i.up&&o.angleDegrees<178&&(o.savedAngle+=Math.PI*(190/180)/.35/60),!i.up&&o.angleDegrees>2&&o.angleDegrees<180&&(o.savedAngle-=Math.PI*(190/180)/.35/60,o.savedAngle<0&&(o.savedAngle=0));break}case 2:case 3:{i.w&&o.angleDegrees>182&&(o.savedAngle-=Math.PI*(190/180)/.35/60),!i.w&&o.angleDegrees<358&&o.angleDegrees>182&&(o.savedAngle+=Math.PI*(190/180)/.35/60,o.savedAngle>Math.PI*2&&(o.savedAngle=Math.PI*2));break}}let y=h.ball;y.x=y.savedX,y.y=y.savedY,Array.isArray(y.savedVelocity)&&!_.goal&&(y.savedX+=y.savedVelocity[0]/60,y.savedY+=y.savedVelocity[1]/60,y.savedVelocity[1]>100&&(y.savedVelocity[1]=100),(y.y<136||y.savedVelocity[1]<0)&&(y.savedVelocity[1]+=4),y.savedVelocity[1]>0&&y.y>136&&(y.savedVelocity[1]=0))};document.querySelector("iframe").contentWindow.c3_runtimeInterface._localRuntime.Tick=new Proxy(document.querySelector("iframe").contentWindow.c3_runtimeInterface._localRuntime.Tick,{apply:function(h,_,y){let o=h.apply(_,y);try{p()}catch{}return o}}),n.addEventListener("message",h=>{if(!h.data.toString().startsWith("update["))return;let _=I(h.data.toString().replace("update[",""));_.id<s||(s=_.id,_.event==="update"&&function(y){_.globalVars&&(y.savedGlobalVars=_.globalVars||{p1Score:0,p2Score:0,goal:0});for(let[m,c]of P(_.players)){let a=y.players.find((d,u)=>m===u);if(a){["x","y","angle"].forEach(d=>{let u=Math.abs(c[d]-a[d]);d==="x"&&u>0&&(a.savedX=c.x,a.savedVelocity=c.velocity,a.savedAngularVelocity=c.angularVelocity),d==="y"&&u>0&&(a.savedY=c.y,a.savedVelocity=c.velocity,a.savedAngularVelocity=c.angularVelocity),d==="angle"&&u>(Math.PI/90,0)&&(a.savedAngle=c.angle,a.savedVelocity=c.velocity,a.savedAngularVelocity=c.angularVelocity)});for(let[d,u]of Object.entries(c.instVars))a.instVars[d]=u}}for(let[m,c]of P(_.heads)){let a=y.heads.find((d,u)=>m===u);if(a){["x","y","angle"].forEach(d=>{let u=Math.abs(c[d]-a[d]);d==="y"&&u>0&&(a.savedY=c.y,a.savedVelocity=c.velocity),d==="angle"&&u>(Math.PI/180,0)&&(a.savedAngle=c.angle,a.savedVelocity=c.velocity),d==="x"&&u>0&&(a.savedX=c.x,a.savedVelocity=c.velocity)});for(let[d,u]of Object.entries(c.instVars))a.instVars[d]=u}}for(let[m,c]of P(_.arms)){let a=y.arms.find((d,u)=>m===u);if(a){["x","y","angle"].forEach(d=>{let u=Math.abs(c[d]-a[d]);d==="x"&&u>0&&(a.savedX=c.x,a.savedVelocity=c.velocity),d==="y"&&u>0&&(a.savedY=c.y,a.savedVelocity=c.velocity),d==="angle"&&u>(Math.PI/180,0)&&(a.savedAngle=c.angle,a.savedVelocity=c.velocity)});for(let[d,u]of Object.entries(c.instVars))a.instVars[d]=u}}let o=y.ball;o.savedX=_.ball.x,o.savedY=_.ball.y,o.savedVelocity=_.ball.velocity;for(let[m,c]of Object.entries(_.ball.instVars))o.instVars[m]=c}(document.querySelector("iframe").contentWindow))}),n.send(JSON.stringify({type:"ready"}))}else return!1})};function P(e){let t=0,n=[];for(let r of e)n.push([t,r]),t++;return n}document.getElementById("game").onload=()=>{let e=document.getElementById("game").contentWindow;e.console.log=new Proxy(e.console.log,{apply:function(t,n,r){return r[0]==="start game called"&&setTimeout(()=>G(),500),Reflect.apply(t,n,r)}})};function G(){let e=document.getElementById("game").contentWindow;e.c3_runtimeInterface._localRuntime.SetTimeScale(1e10),e.dispatchEvent(new PointerEvent("pointerdown",{clientX:e.innerWidth/2,clientY:e.innerHeight/2})),e.savedGlobalVars={p1Score:0,p2Score:0,goal:0},Object.defineProperties(e,{ball:{get:()=>e.c3_runtimeInterface._localRuntime._iRuntime.objects.balls.getAllInstances()[0]},players:{get:()=>[e.c3_runtimeInterface._localRuntime._iRuntime.objects.body.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.body2.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.body3.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.body4.getAllInstances()[0]]},heads:{get:()=>[e.c3_runtimeInterface._localRuntime._iRuntime.objects.head.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.head2.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.head3.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.head4.getAllInstances()[0]]},arms:{get:()=>[e.c3_runtimeInterface._localRuntime._iRuntime.objects.arm.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.arm2.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.arm3.getAllInstances()[0],e.c3_runtimeInterface._localRuntime._iRuntime.objects.arm4.getAllInstances()[0]]},globalVars:{get:()=>e.c3_runtimeInterface._localRuntime._iRuntime.globalVars}}),["keydown","keyup"].forEach(n=>{e.document.addEventListener(n,r=>{e.console.log(`Event: ${n}, Key: ${r.key}`),r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation(),window.dispatchEvent(new CustomEvent("basket-key",{detail:{type:n,key:r.key}}))})});let t=!1;e.AudioDOMHandler.prototype._Play=new Proxy(e.AudioDOMHandler.prototype._Play,{apply:(n,r,i)=>{return console.log(i[0].originalUrl),i[0].originalUrl==="file"&&(e.globalVars.p1Score=0,e.globalVars.p2Score=0),i[0].originalUrl==="start"&&setTimeout(async()=>{e.dispatchEvent(new PointerEvent("pointerup")),await new Promise(s=>setTimeout(s,100)),e.dispatchEvent(new PointerEvent("pointerdown",{clientX:.6*e.innerWidth,clientY:e.innerHeight*.57})),await new Promise(s=>setTimeout(s,100)),e.dispatchEvent(new PointerEvent("pointerup"))},1e3),i[0].originalUrl==="refsoc"&&(t||(t=!0,setTimeout(async()=>{e.dispatchEvent(new PointerEvent("pointerdown",{clientX:.6*e.innerWidth,clientY:e.innerHeight*.57})),await new Promise(s=>setTimeout(s,100)),e.dispatchEvent(new PointerEvent("pointerup")),await new Promise(s=>setTimeout(s,100)),e.dispatchEvent(new PointerEvent("pointerdown",{clientX:.4*e.innerWidth,clientY:e.innerHeight*.57})),await new Promise(s=>setTimeout(s,100)),e.dispatchEvent(new PointerEvent("pointerup")),await new Promise(s=>setTimeout(s,100)),e.c3_runtimeInterface._localRuntime.SetSuspended(!0),window.postMessage({type:"ready"},"*")},250))),!1;return n.apply(r,i)}})}setTimeout(()=>{window.dispatchEvent(new Event("ready"))},1e3);})();
/*! Bundled license information:

reconnecting-websocket/dist/reconnecting-websocket-mjs.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0
  
  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.
  
  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** *)
  (*!
   * Reconnecting WebSocket
   * by Pedro Ladaria <pedro.ladaria@gmail.com>
   * https://github.com/pladaria/reconnecting-websocket
   * License MIT
   *)
*/
//# sourceMappingURL=game.bundle.js.map
